{% load i18n %}

{% block extra_head %}
    <link rel="stylesheet" href="http://leaflet.cloudmade.com/dist/leaflet.css" />
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}admintools_bootstrap/css/custom-theme/jquery-ui-1.8.16.custom.css" />
{% endblock %}

<script type="text/javascript" src="{{ STATIC_URL }}themes/pes_auvergne/default/js/forms_utils.js"></script>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/OpenLayers.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/gis/OpenStreetMap.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/MapWidget.js"></script>

<!-- For tooltips -->
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery-ui-1.9.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.ui.tooltip.js"></script>


<div id="exchanges_top"></div>
<div id="result_exchanges" class="add_form">
    
    {% if mode = 'add' %}
        <h2 class="maj_title">{% trans "Add new exchange" %}</h2>
    {% else %}
        <h2 class="maj_title">{% trans "Modify exchange" %}</h2>
    {% endif %}

    <form action="{{ base_url }}" method="post" class="add_form" enctype="multipart/form-data">{% csrf_token %}

        <div class="bg_form">
            <div class="fieldWrapper">
                {{ form.title.errors }}
                <div class="labelWrapper">{{ form.title.label_tag }} : </div>{{ form.title }}
            </div>          

            <div class="fieldWrapper">
                {{ form.start.errors }}
                <div class="labelWrapper">{{ form.start.label_tag }} : </div>{{ form.start }}
                <div class="help_text" title="{% trans 'Date of start' %}"></div>
            </div>   

            <div class="fieldWrapper">
                {{ form.expiration.errors }}
                <div class="labelWrapper">{{ form.expiration.label_tag }} : </div>{{ form.expiration }}
                <div class="help_text" title="{% trans 'Date of expiration' %}"></div>
            </div>   

            <div class="fieldWrapper">
                {{ form.organization.errors }}
                <div class="labelWrapper">{{ form.organization.label_tag }} : </div>{{ form.organization }}
            </div>        
            
            <div class="fieldWrapper">
                {{ form.img.errors }}
                <div class="labelWrapper">{{ form.img.label_tag }} : </div>
                <div class="help_text" title="{% trans 'First image visible' %}"></div>
                <div class="img_form">{{ form.img }}</div>
                
            </div>

            <div class="fieldWrapper">
                {{ form.eway.errors }}
                <div class="labelWrapper">{{ form.eway.label_tag }} : </div>{{ form.eway }}
            </div>

            <div class="fieldWrapper">
                {{ form.etype.errors }}
                <div class="labelWrapper">{{ form.etype.label_tag }} : </div>{{ form.etype }}
            </div>          

            <div class="fieldWrapper">
                {{ form.methods.errors }}
                <div class="labelWrapper">{{ form.methods.label_tag }} : </div><div id="methods">{{ form.methods }}</div>
            </div>   

<!--            <div class="fieldWrapper">
                {{ form.location.errors }}
                <div class="labelWrapper">{{ form.location.label_tag }} : </div>{{ form.location }}
            </div>  --> 

            <h3 class="title_formset">{% trans "Locations" %}</h3>
            <div id="location" class="fieldWrapper formset">
                <div id="label" class="fieldWrapper">
                    {{ form.label.errors }}
                    <div class="labelWrapper">{{ form.label.label_tag }} : </div>{{ form.label }}
                </div>
                <div id="address" class="fieldWrapper">
                    {{ form.address.errors }}
                    <div class="labelWrapper">{{ form.address.label_tag }} : </div>{{ form.address }}
                </div>
                <div id="city" class="fieldWrapper">
                    {{ form.city.errors }}
                    <div class="labelWrapper">{{ form.city.label_tag }} : </div>{{ form.city }}
                </div>
                <div id="zipcode" class="fieldWrapper">
                    {{ form.zipcode.errors }}
                    <div class="labelWrapper">{{ form.zipcode.label_tag }} : </div>{{ form.zipcode }}
                </div>
                <div id="point" class="fieldWrapper">
                    {{ form.point.errors }}
                    <div class="labelWrapper">{{ form.point.label_tag }} : </div> <div id="point_carto">{{ form.point }}</div>
                </div>
            </div>


<!-- TODO: email de reponse a l annonce -->

            <div class="fieldWrapper">
                {{ form.description.errors }}
                <div class="labelWrapper">{{ form.description.label_tag }} : </div>{{ form.description }}
            </div>   

<!-- TODO: adresse preferee, code postal, ville -->

            <div class="fieldWrapper">
                {{ form.person.errors }}
                <div class="labelWrapper">{{ form.person.label_tag }} : </div>{{ form.person }}
            </div>        


<!-- TODO tel prefere-->
<!-- TODO email prefere-->
<!-- TODO site web -->
<!-- TODO site associe -->

            <!-- Doc associés -->
            <h3 class="title_formset">{% trans "Documents" %}</h3>
            <div id="docs" class="fieldWrapper formset">
                {{ doc_form.management_form }}
                {% for d in doc_form.forms %}
                    <div class='table_formset table_doc'>
                        <table class='no_error'>
                            {{ d.as_table }}
                        </table>
                    </div>
                {% endfor %}
                <input type="button" value="{% trans 'Add More' %}" id="add_more_doc">
                <div class="help_text" title="{% trans 'Click on the button to add other documents' %}"></div>
            </div>


<!-- TODO evenements lies a cette annonce -->
            
            <div class="fieldWrapper">
                {{ form.activity.errors }}
                <div class="labelWrapper">{{ form.activity.label_tag }} : </div>{{ form.activity }}
            </div>   
            
            <div class="fieldWrapper">
                {{ form.transverse_themes.errors }}
                <div class="labelWrapper">{{ form.transverse_themes.label_tag }} : </div>{{ form.transverse_themes }}
                <div class="help_text" title="{% trans 'You may select multiple by pressing Ctrl key' %}"></div>

            </div>   
            
            
            <div class="fieldWrapper">
                {{ form.tags.errors }}
                <div class="labelWrapper">{{ form.tags.label_tag }} : </div>{{ form.tags }}
                <div class="help_text" title="{% trans 'Separate words with a comma' %}"></div>
            </div>   


            <div class="fieldWrapper">
                {{ form.active.errors }}
                <div class="labelWrapper">{{ form.active.label_tag }} : </div>{{ form.active }}
            </div>   

<!-- TODO plus value solidaire -->

            {{ form.errors }}
        </div>

        <div class="new_block" id="new_submit">
            {% if mode = 'add' %}
                <input type="submit" value="{% trans "Create" %}" />                
            {% else %}
                <input type="submit" value="{% trans "Modify" %}" />                
            {% endif %}          
        </div>

    </form>
</div>


<script type="text/javascript">
    $(function() {
        $.datepicker.regional['fr'] = {
            closeText: 'Fermer',
            prevText: '&#x3c;Préc',
            nextText: 'Suiv&#x3e;',
            currentText: 'Courant',
            monthNames: ['Janvier','Février','Mars','Avril','Mai','Juin',
            'Juillet','Août','Septembre','Octobre','Novembre','Décembre'],
            monthNamesShort: ['Jan','Fév','Mar','Avr','Mai','Jun',
            'Jul','Aoû','Sep','Oct','Nov','Déc'],
            dayNames: ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'],
            dayNamesShort: ['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'],
            dayNamesMin: ['Di','Lu','Ma','Me','Je','Ve','Sa'],
            weekHeader: 'Sm',
            dateFormat: 'dd/mm/yy',
            firstDay: 1,
            isRTL: false,
            showMonthAfterYear: false,
            yearSuffix: ''};
        $.datepicker.setDefaults($.datepicker.regional['fr']);

        $('#id_start').datepicker({dateFormat: 'dd/mm/yy', constrainInput: false});
        $('#id_expiration').datepicker({dateFormat: 'dd/mm/yy', constrainInput: false});
        

        $('#add_more_doc').click(function() {
            cloneMore('div.table_doc:last', 'doc');
        });

        $(document).tooltip();

    });
</script>
