{% load i18n %}

{% block extra_head %}
<link rel="stylesheet" href="http://leaflet.cloudmade.com/dist/leaflet.css" />
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}admintools_bootstrap/css/custom-theme/jquery-ui-1.8.16.custom.css" />

<script type="text/javascript" src="/_tinymce/compressor/"></script>
<script type="text/javascript" src="{{ STATIC_URL }}themes/pes_auvergne/default/js/forms_utils.js"></script>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/OpenLayers.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/gis/OpenStreetMap.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/MapWidget.js"></script>

<!-- For tooltips -->
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery-ui-1.9.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.ui.tooltip.js"></script>


{% endblock %}



<div id="agenda_top"></div>
<div id="coop_agenda" class="add_form">
    
    {% if mode = 'add' %}
        <h2 class="maj_title">{% trans "Add new event" %}</h2>
    {% else %}
        <h2 class="maj_title">{% trans "Modify event" %}</h2>
    {% endif %}

    <form action="{{ base_url }}" method="post" class="add_form" enctype="multipart/form-data">{% csrf_token %}

<!--         <div class="bg_form"> -->

            <div class="fieldWrapper">
                {{ form.title.errors }}
                <div class="labelWrapper">{{ form.title.label_tag }} : </div>{{ form.title }}
            </div>
            <div class="fieldWrapper">
                {{ form.organization.errors }}
                <div class="labelWrapper"><label>{% trans "Organizator" %}</label> : </div>{{ form.organization }}
            </div>
            <!-- TODO: poste par           -->
    
            <div class="fieldWrapper">
                {{ form.organizations.errors }}
                <div class="labelWrapper"><label>{% trans "Partners" %}</label> : </div>
                {{ form.organizations }}
                <div class="help_text" title="{% trans 'Patners participating without being the organizator' %}"></div>
            </div>

            <div class="fieldWrapper">
                {{ form.other_organizations.errors }}
                <div class="labelWrapper"><label>{% trans "Other partners" %}</label> : </div>
                {{ form.other_organizations }}
                <div class="help_text" title="{% trans 'Patners not referenced participating without being the organizator' %}"></div>
            </div>

            <div class="fieldWrapper">
                {{ form.image.errors }}
                <div class="labelWrapper">{{ form.image.label_tag }} : </div><div class="help_text" title="{% trans 'This image will be the first visible' %}"></div>
                <div class="img_form">{{ form.image }}</div>
                
            </div>

            <div class="fieldWrapper">
                {{ form.description.errors }}
                <div class="labelWrapper">{{ form.description.label_tag }} : </div>{{ form.description }}
            </div>

            <div class="fieldWrapper date_select">
                {{ occ_form.start_time.errors }}
                <div class="labelWrapper">{{ occ_form.start_time.label_tag }} : </div>{{ occ_form.start_time }}
                <div class="help_text" title="{% trans "Set 00 if no hours needed" %}"></div>
            </div>
            <div class="fieldWrapper date_select">
                {{ occ_form.end_time.errors }}
                <div class="labelWrapper">{{ occ_form.end_time.label_tag }} : </div>{{ occ_form.end_time }}
            </div>

            <!-- Occurences -->
<!--            <h3 class="title_formset">{% trans "Occurences" %}</h3>
            <div id="occ" class="fieldWrapper formset">
                {{ occ_form.management_form }}
                {% for o in occ_form.forms %}
                    <div class='table_formset table_occ'>
                        <table class='no_error'>
                            {{ o.as_table }}
                        </table>
                    </div>
                {% endfor %}
                <input type="button" value="{% trans 'Add More' %}" id="add_more_occ">
            </div>-->


            <h3 class="title_formset">{% trans "Locations" %}</h3>
            <div id="location" class="fieldWrapper formset">
                <div id="label" class="fieldWrapper">
                    {{ form.label.errors }}
                    <div class="labelWrapper">{{ form.label.label_tag }} : </div>{{ form.label }}
                </div>
                <div id="address" class="fieldWrapper">
                    {{ form.address.errors }}
                    <div class="labelWrapper">{{ form.address.label_tag }} : </div>{{ form.address }}
                </div>
                <div id="city" class="fieldWrapper">
                    {{ form.city.errors }}
                    <div class="labelWrapper">{{ form.city.label_tag }} : </div>{{ form.city }}
                </div>
                <div id="zipcode" class="fieldWrapper">
                    {{ form.zipcode.errors }}
                    <div class="labelWrapper">{{ form.zipcode.label_tag }} : </div>{{ form.zipcode }}
                </div>
                <div id="point" class="fieldWrapper">
                    {{ form.point.errors }}
                    <div class="labelWrapper">{{ form.point.label_tag }} : </div> <div id="point_carto">{{ form.point }}</div>
                </div>
            </div>

            <div class="fieldWrapper">
                {{ form.category.errors }}
                <div class="labelWrapper">{{ form.category.label_tag }} : </div> {{ form.category }}
            </div>

            <!-- Doc associés -->
            <h3 class="title_formset">{% trans "Documents" %}</h3>
            <div id="docs" class="fieldWrapper formset">
                {{ doc_form.management_form }}
                {% for d in doc_form.forms %}
                    <div class='table_formset table_doc'>
                        <table class='no_error'>
                            {{ d.as_table }}
                        </table>
                    </div>
                {% endfor %}
                <input type="button" value="{% trans 'Add More' %}" id="add_more_doc">
            </div>


            <!-- TODO: partners           -->
<!--             <div class="help_text">{% trans 'Clic on button to add more locations' %}</div> -->

            <div class="fieldWrapper">
                {{ form.activity.errors }}
                <div class="labelWrapper">{{ form.activity.label_tag }} : </div> {{ form.activity|safe }}
            </div>   
            <div class="fieldWrapper">
                {{ form.transverse_themes.errors }}
                <div class="labelWrapper">{{ form.transverse_themes.label_tag }} : </div>{{ form.transverse_themes|safe }}
            </div>   

            <!-- TODO: articles associated             -->

            <!-- TODO: exchanges associated             -->

            <div class="fieldWrapper">
                {{ form.tags.errors }}
                <div class="labelWrapper">{{ form.tags.label_tag }} : </div>{{ form.tags|safe }}
            </div>   

            <div class="fieldWrapper">
                {{ form.source_info.errors }}
                <div class="labelWrapper">{{ form.source_info.label_tag }} : </div>{{ form.source_info|safe }}
            </div>   


            <!-- TODO: comments             -->

            <div class="fieldWrapper">
                {{ form.active.errors  }}
                <div class="labelWrapper">{{ form.active.label_tag }} : </div>{{ form.active }}
                <div class="help_text" title="{% trans "If not published, the organisation won't be visible on the website. You can access to it by going into your account" %}"></div>
            </div>   

            <div class="fieldWrapper">
                {{ form.zoom_on.errors  }}
                <div class="labelWrapper">{{ form.zoom_on.label_tag }} : </div>{{ form.zoom_on }}
                <div class="help_text" title="{% trans "If set, the event will be publish in the zoom on page" %}"></div>
            </div>   

            {% if status_display %}
            <div class="fieldWrapper">
                {{ form.status.errors  }}
                <div class="labelWrapper">{{ form.status.label_tag }} : </div>{{ form.status }}
            </div>   
            {% endif %}


            {{ form.errors }}
            {{ occ_form.errors }}


        {% if mode = 'add' %}
            <div class="new_block" id="new_submit">
                <input type="submit" value="{% trans "Create" %}" />                
            </div>
        {% else %}
            <div class="new_block" id="modify_submit">
                <input type="submit" value="{% trans "Modify" %}" />                
                <input type="button" value="{% trans "Delete" %}" onclick="delete_object('{% trans 'Are you sure you want to delete this event ?' %}', '{{ delete_url }}')" />                
            </div>
        {% endif %}    

    </form>
</div>


<script type="text/javascript">


tinyMCE_GZ.init({"themes": "advanced", "languages": "fr", "debug": false, "diskcache": true, "plugins": "table,spellchecker,filemanager,paste,searchreplace,inlinepopups"})
</script>


<script type="text/javascript">
    $(function() {
        $.datepicker.regional['fr'] = {
            closeText: 'Fermer',
            prevText: '&#x3c;Préc',
            nextText: 'Suiv&#x3e;',
            currentText: 'Courant',
            monthNames: ['Janvier','Février','Mars','Avril','Mai','Juin',
            'Juillet','Août','Septembre','Octobre','Novembre','Décembre'],
            monthNamesShort: ['Jan','Fév','Mar','Avr','Mai','Jun',
            'Jul','Aoû','Sep','Oct','Nov','Déc'],
            dayNames: ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'],
            dayNamesShort: ['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'],
            dayNamesMin: ['Di','Lu','Ma','Me','Je','Ve','Sa'],
            weekHeader: 'Sm',
            dateFormat: 'dd/mm/yy',
            firstDay: 1,
            isRTL: false,
            showMonthAfterYear: false,
            yearSuffix: ''};
        $.datepicker.setDefaults($.datepicker.regional['fr']);

        $('#id_date_creation').datepicker({dateFormat: 'yy-mm-dd', constrainInput: false});
        $('#id_date_validity').datepicker({dateFormat: 'yy-mm-dd', constrainInput: false});
        $('#id_date_start').datepicker({dateFormat: 'yy-mm-dd', constrainInput: false});
        $('#id_date_end').datepicker({dateFormat: 'yy-mm-dd', constrainInput: false});

        tinyMCE.init({"spellchecker_languages": "", "elements": "id_description", "theme_advanced_buttons3": "", "plugins": "table,spellchecker,filemanager,paste,searchreplace,inlinepopups", "relative_urls": false, "spellchecker_rpc_url": "/_tinymce/spellchecker/", "language": "fr", "theme_advanced_buttons1": "bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,formatselect,fontsizeselect,|,forecolor,backcolor,|,bullist,numlist,|,outdent,indent,|,sub,sup,|,charmap,emotions,separator,forecolor,backcolor", "directionality": "ltr", "theme_advanced_buttons2": "pastetext,pasteword,selectall,|,undo,redo,|,link,unlink,anchor,image,filemanager,code,|,tablecontrols,|,fullscreen", "theme": "advanced", "strict_loading_mode": 1, "mode": "exact"})

        $('#add_more_doc').click(function() {
            cloneMore('div.table_doc:last', 'doc');
        });

        $('#add_more_located').click(function() {
            cloneMore('div.table_located:last', 'located');
        });

        $(document).tooltip();
    });
</script>
