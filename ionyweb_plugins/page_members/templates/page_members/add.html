{% load i18n %}

<script type="text/javascript" src="/_tinymce/compressor/"></script>
<script type="text/javascript" src="{{ STATIC_URL }}themes/pes_auvergne/default/js/forms_utils.js"></script>

<script type="text/javascript" src="{{ STATIC_URL }}tagger/js/jquery.autoSuggest.minified.js"></script>

<link href="{{ STATIC_URL }}css/openlayers.css" type="text/css" media="all" rel="stylesheet" />

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/OpenLayers.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/gis/OpenStreetMap.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/MapWidget.js"></script>

<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}admintools_bootstrap/css/custom-theme/jquery-ui-1.8.16.custom.css" />

<!-- For tooltips -->
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery-ui-1.9.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.ui.tooltip.js"></script>


<div id="members_top"></div>
<div id="members" class="add_form">

    {% if is_project %}
        {% if mode = 'add' %}
            <h2 class="maj_title">{% trans "Add new project" %}</h2>
        {% else %}
            <h2 class="maj_title">{% trans "Modify project" %}</h2>
        {% endif %}
    {% else %}
        {% if mode = 'add' %}
            <h2 class="maj_title">{% trans "Add new member" %}</h2>
        {% else %}
            <h2 class="maj_title">{% trans "Modify member" %}</h2>
        {% endif %}
    {% endif %}

    <form action="{{ base_url }}" method="post" class="add_form" enctype="multipart/form-data">{% csrf_token %}

    <div id="tabs">
        <ul>
            <li><a href="#tabs-1">{% trans "Simple" %}</a></li>
            <li><a href="#tabs-2">{% trans "Detailed" %}</a></li>
            <li><a href="#tabs-3">{% trans "Self evaluation" %}</a></li>
        </ul>
        <div id="tabs-1">

            <h3 class="title_formset">{% trans "General infos" %}</h3>
            <div id="contact" class="fieldWrapper formset">

                <div class="fieldWrapper">
                    {{ form.title.errors  }}
                    <div class="labelWrapper">{{ form.title.label_tag }} : </div>{{ form.title }}
                </div>

                <div class="fieldWrapper">
                    {{ form.acronym.errors  }}
                    <div class="labelWrapper">{{ form.acronym.label_tag }} : </div>{{ form.acronym }}
                </div>

                <div class="fieldWrapper">
                    {{ form.pref_label.errors  }}
                    <div class="labelWrapper">{{ form.pref_label.label_tag }} : </div>{{ form.pref_label }}
                    <div class="help_text" title="{% trans 'Choose if we want to display acronym or title' %}"></div>
                </div>

                <div class="fieldWrapper">
                    {{ form.birth.errors  }}
                    <div class="labelWrapper">{{ form.birth.label_tag }} : </div>{{ form.birth }}
                    <div class="help_text" title="{% trans 'Si you belong to a federation or network, write the creation date of your local unity' %}"></div>
                </div>

                <div class="fieldWrapper">
                    {{ form.category.errors  }}
                    <div class="labelWrapper">{{ form.category.label_tag }} : </div>{{ form.category }}
                </div>

                <div class="fieldWrapper">
                    {{ form.legal_status.errors  }}
                    <div class="labelWrapper">{{ form.legal_status.label_tag }} : </div>{{ form.legal_status }}
                </div>
            </div>

            <h3 class="title_formset">{% trans "Locations" %}</h3>
            <div id="contact" class="fieldWrapper formset">
                {{ located_form.management_form }}
                {% for d in located_form.forms %}
                    <div class='table_formset table_located'>
                        <table class='no_error'>
                            {{ d.as_table }}
                        </table>
                    </div>
                {% endfor %}
                <input type="button" value="{% trans 'Add More location' %}" id="add_more_located">
                <div class="help_text" title="{% trans 'Clic on button to add more locations' %}"></div>
            </div>

            <h3 class="title_formset">{% trans "Contact" %}</h3>
            <div id="contact" class="fieldWrapper formset">
                {{ contact_form.management_form }}
                {% for d in contact_form.forms %}
                    <div class='table_formset table_contact'>
                        <table class='no_error'>
                            {{ d.as_table }}
                        </table>
                    </div>
                {% endfor %}
                <input type="button" value="{% trans 'Add More contact' %}" id="add_more_contact">
            </div>

            <h3 class="title_formset">{% trans "Description" %}</h3>
            <div id="contact" class="fieldWrapper formset">

                <div class="fieldWrapper">
                    {{ form.short_description.errors  }}
                    <div class="labelWrapper">{{ form.short_description.label_tag }} : </div>{{ form.short_description }}
                    <div class="help_text" title="{% trans 'Shirt description of the organization' %}"></div>
                </div>

                <div class="fieldWrapper">
                    {{ form.web.errors  }}
                    <div class="labelWrapper">{{ form.web.label_tag }} : </div>{{ form.web }}
                </div>

                <div class="fieldWrapper">
                    {{ form.description.errors  }}
                    {{ form.description.label_tag }} : <div class="help_text" title="{% trans 'No more than x signes' %}"></div>{{ form.description }}
                </div>

                <div class="fieldWrapper">
                    {{ form.description2.errors  }}
                    {{ form.description2.label_tag }} : <div class="help_text" title="{% trans 'If description does not fit' %}"></div>{{ form.description2 }}
                </div>

                {% if is_project %}
                    <div class="fieldWrapper">
                        {{ form.crowdfunding.errors  }}
                        <div class="labelWrapper"><label for="id_crowdfunding">{% trans "Crowdfunding link" %}</label> : </div>{{ form.crowdfunding }}
                    </div>
                {% endif %}

                <!--<div class="fieldWrapper">
                    {{ form.activity.errors  }}
                    {{ form.activity.label_tag }} : {{ form.activity }}
                </div>-->

                <div class="fieldWrapper">
                    {{ form.transverse_themes.errors  }}
                    <div class="labelWrapper">{{ form.transverse_themes.label_tag }} :</div>{{ form.transverse_themes }}
                    <div class="help_text" title="{% trans 'You can choose more than one by pressing the CTRL key' %}"></div>
                </div>


                <div class="fieldWrapper">
                    {{ form.logo.errors  }}
                    <div class="labelWrapper">{{ form.logo.label_tag }} :</div> <div class="img_form">{{ form.logo }}</div>
                </div>

                <div class="fieldWrapper">
                    {{ form.tags.errors  }}
                    <div class="labelWrapper">{{ form.tags.label_tag }} :</div> {{ form.tags }}
                    <div class="help_text" title="{% trans 'Give more visibility to your data and makes research easier' %}"></div>
                </div>

                <div class="fieldWrapper">
                    {{ form.source_info.errors  }}
                    <div class="labelWrapper">{{ form.source_info.label_tag }} : </div>{{ form.source_info }}
                </div>

            </div>



            <h3 class="title_formset">{% trans "Preferences" %}</h3>
            <div id="preferences" class="fieldWrapper formset">
                <div class="fieldWrapper">
                    {{ form.pref_address.errors  }}
                    <div class="labelWrapper">{{ form.pref_address.label_tag }} : </div>{{ form.pref_address }}
                </div>

                <div class="fieldWrapper">
                    {{ form.pref_email.errors  }}
                    <div class="labelWrapper">{{ form.pref_email.label_tag }} : </div>{{ form.pref_email }}
                </div>

                <div class="fieldWrapper">
                    {{ form.pref_phone.errors  }}
                    <div class="labelWrapper">{{ form.pref_phone.label_tag }} : </div>{{ form.pref_phone }}
                </div>

                <div class="fieldWrapper">
                    {{ form.active.errors  }}
                    <div class="labelWrapper">{{ form.active.label_tag }} : </div>{{ form.active }}
                    <div class="help_text" title="{% trans "If not published, the organisation won't be visible on the website. You can access to it by going into your account" %}"></div>
                </div>
                

            </div>


        </div>


        <div id="tabs-2">
            <!-- Doc associés -->
            <h3 class="title_formset">{% trans "Documents" %}</h3>
            <div id="docs" class="fieldWrapper formset">
                {{ doc_form.management_form }}
                {% for d in doc_form.forms %}
                    <div class='table_formset table_doc'>
                        <table class='no_error'>
                            {{ d.as_table }}
                        </table>
                    </div>
                {% endfor %}
                <input type="button" value="{% trans 'Add More document' %}" id="add_more_doc">
                <div class="help_text" title="{% trans 'Clic on button to add more documents' %}"></div>
            </div>

            <div class="fieldWrapper">
                {{ form.guaranties.errors  }}
                <div class="labelWrapper">{{ form.guaranties.label_tag }} : </div>{{ form.guaranties }}
                <div class="help_text" title="{% trans 'You can choose more than one by pressing the CTRL key' %}"></div>
            </div>


            <h3 class="title_formset">{% trans "Relationship" %}</h3>
            <div id="rel" class="fieldWrapper formset">
                {{ rel_form.management_form }}
                {% for d in rel_form.forms %}
                    <div class='table_formset table_rel'>
                        <table class='no_error'>
                            {{ d.as_table }}
                        </table>
                    </div>
                {% endfor %}
                <input type="button" value="{% trans 'Add More relation' %}" id="add_more_rel">
                <div class="help_text" title="{% trans 'Click the button to add more relations' %}"></div>
            </div>


            <!--  liste produits et services            -->
            <h3 class="title_formset">{% trans "Activity detail" %}</h3>
            <div id="offer" class="fieldWrapper formset">
                {{ offer_form.management_form }}
                {% for d in offer_form.forms %}
                    <div class='table_formset table_offer'>
                        <table class='no_error'>
                            {{ d.as_table }}
                        </table>
                    </div>
                {% endfor %}
                <input type="button" value="{% trans 'Add More offer' %}" id="add_more_offer">
            </div>



            



            <!--  TODO: membre à contact préféré            -->

            <!-- TODO plus value solidaire -->
            <h3 class="title_formset">{% trans "Complementary informations" %}</h3>
            <div id="offer" class="fieldWrapper formset">

                <div class="fieldWrapper">
                    {{ form.annual_revenue.errors  }}
                    <div class="labelWrapper">{{ form.annual_revenue.label_tag }} : </div>{{ form.annual_revenue }}
                </div>

                <div class="fieldWrapper">
                    {{ form.workforce.errors  }}
                    <div class="labelWrapper">{{ form.workforce.label_tag }} : </div>{{ form.workforce }}
                </div>

                <div class="fieldWrapper">
                    {{ form.siret.errors  }}
                    <div class="labelWrapper">{{ form.siret.label_tag }} : </div>{{ form.siret }}
                </div>

                <div class="fieldWrapper">
                    {{ form.notes.errors  }}
                    <div class="labelWrapper">{{ form.notes.label_tag }} : </div>{{ form.notes }}
                </div>
            </div>
            
            <!-- Membres             -->
<!--            <h3 class="title_formset">{% trans "Engagement" %}</h3>
            <div id="eng" class="fieldWrapper formset">
                {{ engagement_form.management_form }}
                {% for d in engagement_form.forms %}
                    <div class='table_formset table_eng'>
                        <table class='no_error'>
                            {{ d.as_table }}
                        </table>
                    </div>
                {% endfor %}
                <input type="button" value="{% trans 'Add More engagement' %}" id="add_more_eng">
            </div>-->

            <!--  Standby            -->
<!--            <h3>{% trans "References" %}</h3>
            <div id="refs" class="fieldWrapper formset">
                {{ reference_form.management_form }}
                {% for d in reference_form.forms %}
                    <div class='table_formset table_ref'>
                        <table class='no_error'>
                            {{ d.as_table }}
                        </table>
                    </div>
                {% endfor %}
                <input type="button" value="{% trans 'Add More' %}" id="add_more_ref">
            </div>-->


<!--            <div class="fieldWrapper">
                {{ form.testimony.errors  }}
                {{ form.testimony.label_tag }} : {{ form.testimony }}
            </div>-->
<!--         </div> -->
        </div>
        <div id="tabs-3">
            <h3>{% trans "Soon" %}</h3>
        </div>
    </div>



                          
        {{ form.errors }}


        
        {% if mode = 'add' %}
            <div class="new_block" id="new_submit">
                <input type="submit" value="{% trans "Create" %}" />                
            </div>
        {% else %}
            <div class="new_block" id="modify_submit">
                <input type="submit" value="{% trans "Modify" %}" />                
                <input type="button" value="{% trans "Delete" %}" onclick="delete_object('{% trans 'Are you sure you want to delete this structure ?' %}', '{{ delete_url }}')" />                
            </div>
        {% endif %}          

    </form>
</div>


<script type="text/javascript">
    $(function() {

        $.datepicker.regional['fr'] = {
            closeText: 'Fermer',
            prevText: '&#x3c;Préc',
            nextText: 'Suiv&#x3e;',
            currentText: 'Courant',
            monthNames: ['Janvier','Février','Mars','Avril','Mai','Juin',
            'Juillet','Août','Septembre','Octobre','Novembre','Décembre'],
            monthNamesShort: ['Jan','Fév','Mar','Avr','Mai','Jun',
            'Jul','Aoû','Sep','Oct','Nov','Déc'],
            dayNames: ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'],
            dayNamesShort: ['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'],
            dayNamesMin: ['Di','Lu','Ma','Me','Je','Ve','Sa'],
            weekHeader: 'Sm',
            dateFormat: 'dd/mm/yy',
            firstDay: 1,
            isRTL: false,
            showMonthAfterYear: false,
            yearSuffix: ''};
        $.datepicker.setDefaults($.datepicker.regional['fr']);

        $('#id_date_validity').datepicker({dateFormat: 'yy-mm-dd', constrainInput: false});
        $('#id_date_start').datepicker({dateFormat: 'yy-mm-dd', constrainInput: false});
        $('#id_date_end').datepicker({dateFormat: 'yy-mm-dd', constrainInput: false});

//         tinyMCE.init({"spellchecker_languages": "Arabe=ar,Az\u00e9ri=az,Bulgare=bg,Bengal\u00ee=bn,Bosniaque=bs,Catalan=ca,Tch\u00e8que=cs,Gallois=cy,Dannois=da,Allemand=de,Grec=el,Anglais / Anglais britannique=en,Esperanto=eo,Espagnol / Espagnol argentin / Espagnol mexicain / Espagnol nicaraguayen=es,Estonien=et,Basque=eu,Perse=fa,Finlandais=fi,+Fran\u00e7ais=fr,Frise=fy,Irlandais=ga,Galicien=gl,H\u00e9breu=he,Hindi=hi,Croate=hr,Hongrois=hu,Indon\u00e9sien=id,Islandais=is,Italien=it,Japonais=ja,G\u00e9orgien=ka,Kazakh=kk,Khmer=km,Kannada=kn,Cor\u00e9en=ko,Lituanien=lt,Letton=lv,Mac\u00e9donien=mk,Malay\u00e2lam=ml,Mongole=mn,Norv\u00e9gien Bokmal=nb,Nepali=ne,Hollandais=nl,Norv\u00e9gien Nynorsk=nn,Penjabi=pa,Polonais=pl,Portugais / Portugais br\u00e9silien=pt,Roumain=ro,Russe=ru,Slovaque=sk,Slov\u00e8ne=sl,Albanais=sq,Serbe / Serbe latin=sr,Su\u00e9dois=sv,Swahili=sw,Tamoul=ta,T\u00e9lougou=te,Tha\u00ef=th,Turc=tr,Tatar=tt,Chinois simplifi\u00e9 / Chinois traditionnel=zh",
//         "elements": "id_description2", "theme_advanced_buttons3": "", "plugins": "table,spellchecker,filemanager,paste,searchreplace,inlinepopups", "relative_urls": false, "spellchecker_rpc_url": "/_tinymce/spellchecker/", "language": "fr", 
//         "theme_advanced_buttons1": "bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,formatselect,fontsizeselect,|,forecolor,backcolor,|,bullist,numlist,|,outdent,indent,|,sub,sup,|,charmap,emotions,separator,forecolor,backcolor", "directionality": "ltr",
//         "theme_advanced_buttons2": "pastetext,pasteword,selectall,|,undo,redo,|,link,unlink,anchor,image,filemanager,code,|,tablecontrols,|,fullscreen", "theme": "advanced", "strict_loading_mode": 1, "mode": "exact", "width": "300px"});
                                
        tinyMCE.init({"spellchecker_languages": "Arabe=ar,Az\u00e9ri=az,Bulgare=bg,Bengal\u00ee=bn,Bosniaque=bs,Catalan=ca,Tch\u00e8que=cs,Gallois=cy,Dannois=da,Allemand=de,Grec=el,Anglais / Anglais britannique=en,Esperanto=eo,Espagnol / Espagnol argentin / Espagnol mexicain / Espagnol nicaraguayen=es,Estonien=et,Basque=eu,Perse=fa,Finlandais=fi,+Fran\u00e7ais=fr,Frise=fy,Irlandais=ga,Galicien=gl,H\u00e9breu=he,Hindi=hi,Croate=hr,Hongrois=hu,Indon\u00e9sien=id,Islandais=is,Italien=it,Japonais=ja,G\u00e9orgien=ka,Kazakh=kk,Khmer=km,Kannada=kn,Cor\u00e9en=ko,Lituanien=lt,Letton=lv,Mac\u00e9donien=mk,Malay\u00e2lam=ml,Mongole=mn,Norv\u00e9gien Bokmal=nb,Nepali=ne,Hollandais=nl,Norv\u00e9gien Nynorsk=nn,Penjabi=pa,Polonais=pl,Portugais / Portugais br\u00e9silien=pt,Roumain=ro,Russe=ru,Slovaque=sk,Slov\u00e8ne=sl,Albanais=sq,Serbe / Serbe latin=sr,Su\u00e9dois=sv,Swahili=sw,Tamoul=ta,T\u00e9lougou=te,Tha\u00ef=th,Turc=tr,Tatar=tt,Chinois simplifi\u00e9 / Chinois traditionnel=zh",
        "elements": "id_description2", "theme_advanced_buttons3": "", "plugins": "table,spellchecker,filemanager,paste,searchreplace,inlinepopups", "relative_urls": false, "spellchecker_rpc_url": "/_tinymce/spellchecker/", "language": "fr", 
        "theme_advanced_buttons1": "bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,formatselect,fontsizeselect,|,forecolor,backcolor,|,bullist,numlist,|,outdent,indent,|,charmap,emotions,separator,forecolor,backcolor", "directionality": "ltr",
        "theme_advanced_buttons2": "sub,sup,|,selectall,|,undo,redo,|,link,unlink,filemanager,code,|,tablecontrols,|,fullscreen",
        "theme": "advanced", "strict_loading_mode": 1, "mode": "exact", "width": "300px"});

        $("table#id_description_tbl.mceLayout").height('300px');


        $('#add_more_doc').click(function() {
            cloneMore('div.table_doc:last', 'doc');
        });
        $('#add_more_offer').click(function() {
            cloneMore('div.table_offer:last', 'offer');
        });
        $('#add_more_ref').click(function() {
            cloneMore('div.table_ref:last', 'ref');
        });
        $('#add_more_eng').click(function() {
            cloneMore('div.table_eng:last', 'eng');
        });
        $('#add_more_rel').click(function() {
            cloneMore('div.table_rel:last', 'rel');
        });
        $('#add_more_contact').click(function() {
            cloneMore('div.table_contact:last', 'contact');
        });
        $('#add_more_located').click(function() {
            cloneMore('div.table_located:last', 'located');
        });

        $( "#tabs" ).tabs();

        $(".help_text").tooltip();
        

//         $("#id_tags").autoSuggest(data);
//         $("#id_tags").autoSuggest("http://mysite.com/path/to/script", {minChars: 2, matchCase: true});


//         tags_as_string = $('#id_tags').val();
//         $("#id_tags__tagautosuggest").autoSuggest("/list/", {
//             asHtmlID: "id_tags__tagautosuggest",
//             startText: "Entrez vos tags ici",
//             emptyText: "Aucun résultat",
//             limitText: "Vous ne pouvez pas faire plus de sélection",
//             preFill: tags_as_string,
//             queryParam: 'q',
//             retrieveLimit: 20,
//             minChars: 1,
//             neverSubmit: true
//         });
// 
//         $('#id_tags').parents().find('form').submit(function (){
//             tags_as_string = $("#as-values-id_tags__tagautosuggest").val();
//             $("#id_tags__tagautosuggest").remove();
//             $("#id_tags").val(tags_as_string);
//         });


        // Sample: Move the paragraph from #myDiv1 to #myDiv2
        //$('#myDiv2').append( $('#myDiv1>p') );

    });


</script>



